'use client'

import Image from 'next/image'
import Link from 'next/link'
import { useSearchParams } from 'next/navigation'
import { useEffect, useState } from 'react'

export default function HomePage() {
  const searchParams = useSearchParams()
  const [processing, setProcessing] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [userId, setUserId] = useState<string | null>(null)

  useEffect(() => {
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰userIdã‚’å–å¾—
    const id = searchParams.get('userId')
    setUserId(id)
    
    // é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆç”¨ã®userIdã‚’è¨­å®š
    if (!id && process.env.NODE_ENV === 'development') {
      setUserId('test-user-' + Date.now())
    }
  }, [searchParams])

  const handleCheckout = async () => {
    if (!userId) {
      setError('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚LINEã‚¢ãƒ—ãƒªã‹ã‚‰é–‹ã„ã¦ãã ã•ã„ã€‚')
      return
    }

    try {
      setProcessing(true)
      setError(null)

      // Checkoutã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
      const response = await fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId }),
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')
      }

      // Stripeã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      window.location.href = data.url

    } catch (err) {
      setError(err instanceof Error ? err.message : 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')
      setProcessing(false)
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 to-purple-50">
      <div className="max-w-md mx-auto px-4 py-8">
        {/* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
        <header className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-800 mb-4">
            AIå†™ãƒ¡æ—¥è¨˜ã§<br />ã‚‚ã£ã¨ç¨¼ã’ã‚‹æ¯æ—¥ã«
          </h1>
          <p className="text-lg text-gray-600">
            AIãŒã‚ãªãŸã®é­…åŠ›ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã™<br />
            ãƒ—ãƒ­ç´šã®æ—¥è¨˜ã‚’è‡ªå‹•ç”Ÿæˆ
          </p>
        </header>

        {/* ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« */}
        <div className="relative w-full h-64 mb-12 rounded-2xl overflow-hidden shadow-xl">
          <Image
            src="/images/hero-visual.jpg"
            alt="AIå†™ãƒ¡æ—¥è¨˜"
            fill
            className="object-cover"
            priority
          />
        </div>

        {/* ç‰¹å¾´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
        <section className="mb-12">
          <h2 className="text-2xl font-bold text-center mb-8">
            ãƒ—ãƒ©ã‚¹ãƒ—ãƒ©ãƒ³ã®ç‰¹å¾´
          </h2>
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-xl shadow-md">
              <h3 className="font-bold text-lg mb-2">ğŸ¤– ã‚ãªãŸå°‚ç”¨ã®AI</h3>
              <p className="text-gray-600">
                ã‚ãªãŸã®æ–‡ä½“ã‚’å­¦ç¿’ã—ã€å€‹æ€§ã‚’æ´»ã‹ã—ãŸæ—¥è¨˜ã‚’ç”Ÿæˆ
              </p>
            </div>
            <div className="bg-white p-6 rounded-xl shadow-md">
              <h3 className="font-bold text-lg mb-2">âš¡ æ™‚çŸ­ã§åç›ŠUP</h3>
              <p className="text-gray-600">
                æ—¥è¨˜ä½œæˆæ™‚é–“ã‚’90%å‰Šæ¸›ã€ç©ºã„ãŸæ™‚é–“ã§æ¥å®¢ã«é›†ä¸­
              </p>
            </div>
            <div className="bg-white p-6 rounded-xl shadow-md">
              <h3 className="font-bold text-lg mb-2">ğŸ“ˆ åå¿œç‡3å€</h3>
              <p className="text-gray-600">
                AIãŒåˆ†æã—ãŸã€Œèª­ã¾ã‚Œã‚‹æ—¥è¨˜ã€ã§äºˆç´„ç‡ã‚¢ãƒƒãƒ—
              </p>
            </div>
          </div>
        </section>

        {/* æ–™é‡‘ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
        <section className="mb-12">
          <div className="bg-gradient-to-r from-pink-500 to-purple-500 p-8 rounded-2xl text-white text-center">
            <h2 className="text-2xl font-bold mb-4">
              ä»Šãªã‚‰ç‰¹åˆ¥ä¾¡æ ¼
            </h2>
            <div className="text-5xl font-bold mb-2">
              Â¥980
              <span className="text-xl font-normal">/æœˆ</span>
            </div>
            <p className="mb-6 text-sm">
              ã„ã¤ã§ã‚‚è§£ç´„OK
            </p>
            
            {/* æ±ºæ¸ˆãƒœã‚¿ãƒ³ */}
            <button
              onClick={handleCheckout}
              disabled={processing}
              className={`w-full bg-white text-gray-800 font-bold py-4 px-8 rounded-full text-lg transition-all ${
                processing 
                  ? 'opacity-50 cursor-not-allowed' 
                  : 'hover:scale-105 hover:shadow-lg'
              }`}
            >
              {processing ? 'å‡¦ç†ä¸­...' : (
                <>ä»Šã™ãã€Œãƒ—ãƒ©ã‚¹ãƒ—ãƒ©ãƒ³ã€ã‚’<br />ä½“é¨“ã™ã‚‹</>
              )}
            </button>
            
            {error && (
              <p className="mt-4 text-yellow-200 text-sm">
                {error}
              </p>
            )}
          </div>
        </section>

        {/* ã‚ˆãã‚ã‚‹è³ªå• */}
        <section className="mb-12">
          <h2 className="text-2xl font-bold text-center mb-8">
            ã‚ˆãã‚ã‚‹è³ªå•
          </h2>
          <div className="space-y-4">
            <details className="bg-white p-4 rounded-lg">
              <summary className="font-bold cursor-pointer">
                è§£ç´„ã¯ã„ã¤ã§ã‚‚ã§ãã¾ã™ã‹ï¼Ÿ
              </summary>
              <p className="mt-2 text-gray-600">
                ã¯ã„ã€ã„ã¤ã§ã‚‚è§£ç´„å¯èƒ½ã§ã™ã€‚è§£ç´„å¾Œã‚‚å½“æœˆæœ«ã¾ã§ã¯ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚
              </p>
            </details>
            <details className="bg-white p-4 rounded-lg">
              <summary className="font-bold cursor-pointer">
                AIã¯ã©ã®ãã‚‰ã„å­¦ç¿’ã—ã¾ã™ã‹ï¼Ÿ
              </summary>
              <p className="mt-2 text-gray-600">
                æœ€åˆã®10ä»¶ã®æ—¥è¨˜ã§åŸºæœ¬çš„ãªæ–‡ä½“ã‚’å­¦ç¿’ã—ã€ä½¿ãˆã°ä½¿ã†ã»ã©ç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚
              </p>
            </details>
            <details className="bg-white p-4 rounded-lg">
              <summary className="font-bold cursor-pointer">
                ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¨ã®é•ã„ã¯ï¼Ÿ
              </summary>
              <p className="mt-2 text-gray-600">
                ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¯æ±ç”¨çš„ãªæ—¥è¨˜ç”Ÿæˆã®ã¿ã€‚ãƒ—ãƒ©ã‚¹ãƒ—ãƒ©ãƒ³ã¯ã‚ãªãŸå°‚ç”¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸAIãŒä½¿ãˆã¾ã™ã€‚
              </p>
            </details>
          </div>
        </section>

        {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}
        <footer className="text-center text-gray-500 text-sm">
          <Link href="/terms" className="hover:text-gray-700">
            åˆ©ç”¨è¦ç´„
          </Link>
          <span className="mx-2">|</span>
          <Link href="/privacy" className="hover:text-gray-700">
            ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼
          </Link>
          <p className="mt-4">
            Â© 2024 AIå†™ãƒ¡æ—¥è¨˜ All Rights Reserved.
          </p>
        </footer>
      </div>
    </div>
  )
}